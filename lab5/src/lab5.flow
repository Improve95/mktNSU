import string;
import math/math;
import ds/tree;
import lingo/pegcode/driver;
import fs/filesystem;

export {
  Expr ::= Sum, Mul, Int;
    Int(val : int);
    Sum(lhs : Expr, rhs : Expr);
    Mul(lhs : Expr, rhs : Expr);

  ar2i(e : Expr) -> int {
    switch (e) {
      Int(val): val;
      Sum(lhs, rhs): ar2i(lhs) + ar2i(rhs);
      Mul(lhs, rhs): ar2i(lhs) * ar2i(rhs);
    }
  }

  calculate(str : string) -> int {
    expr = parsic(
      compilePegGrammar("#include exprParser.lingo"),
      str, 
      SemanticActions(setTree(defaultPegActions.t, "createInt", \s -> Int(s2i(s[0]))))
    );
    ar2i(expr)
  }
}

main() {
  expr = "5+5";
  println(calculate(expr));

  quit(0);
}
